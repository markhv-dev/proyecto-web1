<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil - MTC</title>
    <link rel="stylesheet" href="../assets/css/styles.css">
</head>
<body>
    <header>
        <h1>Simulacro MTC</h1>
    </header>

    <nav>
        <ul>
            <li><a href="../../public/index.html">Inicio</a></li>
            <li><a href="simulacro.html">Simulacro</a></li>
            <li><a href="preguntas.html">Preguntas rápidas</a></li>
            <li><a href="resultados.html">Resultados</a></li>
            <li><a href="perfil.html" class="active">Perfil</a></li>
        </ul>
    </nav>

    <main class="perfil-container">
        <section>
            <h2>Mi Perfil</h2>

            <div class="datos-usuario">
                <p><strong>Nombre:</strong> <span id="nombre-usuario">Usuario MTC</span></p>
                <p><strong>Correo:</strong> <span id="correo-usuario">usuario@correo.com</span></p>
                <p><strong>Categoría seleccionada:</strong> <span id="categoria-actual">No seleccionada</span></p>
                <p><strong>Último puntaje:</strong> <span id="ultimo-puntaje">--</span></p>
            </div>

            <div class="cambiar-categoria" style="margin: 20px 0;">
                <button class="boton-inicio" id="btn-cambiar-categoria">
                    <span>Cambiar categoría</span>
                    <span id="flecha" style="margin-left: 10px;">▼</span>
                </button>

                <div id="panel-categorias" class="panel-categorias" style="display: none; margin-top: 15px;">
                    <h4 style="margin-bottom: 15px; color: #3a1c4a;">Seleccionar categoría:</h4>
                    <div class="categorias">
                        <button class="btn-categoria" data-categoria="AI">A-I</button>
                        <button class="btn-categoria" data-categoria="AII-A">A-II-A</button>
                        <button class="btn-categoria" data-categoria="AII-B">A-II-B</button>
                        <button class="btn-categoria" data-categoria="AIII-A">A-III-A</button>
                        <button class="btn-categoria" data-categoria="AIII-B">A-III-B</button>
                        <button class="btn-categoria" data-categoria="AIII-C">A-III-C</button>
                        <button class="btn-categoria" data-categoria="BII-A">B-II-A</button>
                        <button class="btn-categoria" data-categoria="BII-B">B-II-B</button>
                        <button class="btn-categoria" data-categoria="BII-C">B-II-C</button>
                    </div>
                </div>
            </div>

            <section class="historial">
                <h3>Historial de simulacros</h3>
                <table class="tabla-historial">
                    <thead>
                        <tr>
                            <th>N°</th>
                            <th>Fecha</th>
                            <th>Puntaje</th>
                            <th>Resultado</th>
                        </tr>
                    </thead>
                    <tbody id="lista-intentos">
                        <tr>
                            <td>1</td>
                            <td>05/10/2025</td>
                            <td>18/20</td>
                            <td>Aprobado</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>07/10/2025</td>
                            <td>15/20</td>
                            <td>Aprobado</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <div class="acciones">
                <button class="boton-inicio" id="btn-editar">
                    <span>Editar perfil</span>
                    <span id="flecha-editar" style="margin-left: 10px;">▼</span>
                </button>
                <a href="../../public/index.html" class="boton-inicio" id="btn-cerrar-sesion">Cerrar sesión</a>
            </div>

            <div id="panel-editar" class="panel-categorias" style="display: none; margin-top: 15px;">
                <h4 style="margin-bottom: 15px; color: #3a1c4a;">Editar información del perfil:</h4>
                <form id="form-editar-perfil">
                    <div class="campo-edicion">
                        <label for="edit-nombre">Nombre:</label>
                        <input type="text" id="edit-nombre" class="input-perfil" placeholder="Ingrese su nombre">
                    </div>
                    <div class="campo-edicion">
                        <label for="edit-correo">Correo:</label>
                        <input type="email" id="edit-correo" class="input-perfil" placeholder="Ingrese su correo">
                    </div>
                    <div class="botones-edicion">
                        <button type="button" class="boton-inicio" id="btn-guardar-perfil">Guardar cambios</button>
                        <button type="button" class="boton-inicio" id="btn-cancelar-edicion">Cancelar</button>
                    </div>
                </form>
            </div>
        </section>
    </main>

    <footer>
        <p>© 2025 Simulacro MTC | Proyecto académico</p>
    </footer>

    <script>
        // Cargar datos del perfil desde localStorage
        function cargarDatosUsuario() {
            let categoriaActual = localStorage.getItem('categoria');
            let nombreUsuario = localStorage.getItem('nombreUsuario') || 'Usuario MTC';
            let correoUsuario = localStorage.getItem('correoUsuario') || 'usuario@correo.com';
            let ultimoPuntaje = localStorage.getItem('puntaje');

            if (categoriaActual) {
                document.getElementById('categoria-actual').textContent = categoriaActual;
            }

            document.getElementById('nombre-usuario').textContent = nombreUsuario;
            document.getElementById('correo-usuario').textContent = correoUsuario;

            if (ultimoPuntaje) {
                document.getElementById('ultimo-puntaje').textContent = ultimoPuntaje + '/40';
            }
        }

        // Cargar datos al inicio
        cargarDatosUsuario();

        // Toggle panel de categorías
        document.getElementById('btn-cambiar-categoria').addEventListener('click', function() {
            const panel = document.getElementById('panel-categorias');
            const flecha = document.getElementById('flecha');

            if (panel.style.display === 'none') {
                panel.style.display = 'block';
                flecha.textContent = '▲';
            } else {
                panel.style.display = 'none';
                flecha.textContent = '▼';
            }
        });

        // Botones para cambiar categoría
        document.querySelectorAll('.btn-categoria').forEach(boton => {
            boton.addEventListener('click', function() {
                let nuevaCategoria = this.getAttribute('data-categoria');
                localStorage.setItem('categoria', nuevaCategoria);
                document.getElementById('categoria-actual').textContent = nuevaCategoria;

                // Cerrar panel después de seleccionar
                document.getElementById('panel-categorias').style.display = 'none';
                document.getElementById('flecha').textContent = '▼';

                alert('Categoría cambiada a: ' + nuevaCategoria);
            });
        });

        // Toggle panel de edición
        document.getElementById('btn-editar').addEventListener('click', function() {
            const panel = document.getElementById('panel-editar');
            const flecha = document.getElementById('flecha-editar');

            if (panel.style.display === 'none') {
                // Cargar datos actuales en los inputs
                document.getElementById('edit-nombre').value = localStorage.getItem('nombreUsuario') || '';
                document.getElementById('edit-correo').value = localStorage.getItem('correoUsuario') || '';

                panel.style.display = 'block';
                flecha.textContent = '▲';
            } else {
                panel.style.display = 'none';
                flecha.textContent = '▼';
            }
        });

        // Guardar cambios del perfil
        document.getElementById('btn-guardar-perfil').addEventListener('click', function() {
            const nuevoNombre = document.getElementById('edit-nombre').value.trim();
            const nuevoCorreo = document.getElementById('edit-correo').value.trim();

            if (nuevoNombre === '' || nuevoCorreo === '') {
                alert('Por favor, complete todos los campos.');
                return;
            }

            // Validar formato de correo básico
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(nuevoCorreo)) {
                alert('Por favor, ingrese un correo válido.');
                return;
            }

            // Guardar en localStorage
            localStorage.setItem('nombreUsuario', nuevoNombre);
            localStorage.setItem('correoUsuario', nuevoCorreo);

            // Actualizar la vista
            cargarDatosUsuario();

            // Cerrar panel
            document.getElementById('panel-editar').style.display = 'none';
            document.getElementById('flecha-editar').textContent = '▼';

            alert('Perfil actualizado correctamente.');
        });

        // Cancelar edición
        document.getElementById('btn-cancelar-edicion').addEventListener('click', function() {
            document.getElementById('panel-editar').style.display = 'none';
            document.getElementById('flecha-editar').textContent = '▼';
        });
    </script>
</body>
</html>
